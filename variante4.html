
<html>
		<head>
		</head>
		<body>
		<script>

//grafik parameter
var height=500;
var width=800;



//global variabeln
var nFiles=5;
var xhr=[];
var count=0;

//spaltenbenennung fürs array <-> csv
var timestamp=0;
var pac=5;
var pdc=6;
var udc=7;
var temp=8;


var totalLength = 0;




function addCounters()
{
	
	for (i=0; i<nFiles; i++)
	if (xhr[i].status==200)
	{
		xhr[i]["count"]=xhr[i].response.split("\n").length -1 - 1;  //schneidet CSV Header ab, zweites -1 berücksichtigt dass arrayfeld bei 0 beginnt
		//alert(xhr[i].count);
	
	}
	else
	{
		xhr[i]["count"]=0;
	}
}

function countTotalRows()
{

	for (i=0; i<nFiles; i++)
	{
		{
			//alert(xhr[i].count);
			totalLength += xhr[i].count;
		}
	}
}


	var stringArray;

function createArray()
{

	
	addCounters();
	countTotalRows();

	stringArray = [totalLength];


	for (i=0; i<totalLength; i++)
	{
		
		stringArray[i]=[];
		for (j=0; j<temp+1; j++)
			stringArray[i][j]=0;
	}

	var arrayCounter = 0;

	for (i=0; i<nFiles; i++)
	{
		for (j=0; j<xhr[i].count; j++)
		{
			stringArray[arrayCounter][timestamp] = xhr[i].response.split("\n")[j+1].split(";")[timestamp] ;
			stringArray[arrayCounter][pac] = xhr[i].response.split("\n")[j+1].split(";")[pac] ;
			stringArray[arrayCounter][pdc] = xhr[i].response.split("\n")[j+1].split(";")[pdc] ;
			stringArray[arrayCounter][udc] = xhr[i].response.split("\n")[j+1].split(";")[udc] ;
			stringArray[arrayCounter][temp] = xhr[i].response.split("\n")[j+1].split(";")[temp] ;

			arrayCounter+=1;
		}
		
	}


	stringArray.sort(function(a,b){
		    return a[timestamp] - b[timestamp];
	});

	printArray();
}

var myString;

function printArray()
{

	myString = "";

	var div = document.getElementById('output');
	
	for(i=0; i<stringArray.length; i++)
	{
		myString += stringArray[i][timestamp] + ": ";
		myString += stringArray[i][pac] + " - ";
		myString += stringArray[i][pdc] + " - ";
		myString += stringArray[i][udc] + " - ";
		myString += stringArray[i][temp] + "<br>";
	}

	div.innerHTML = myString;
}



for (i=0; i<nFiles; i++)
{
	
	//Hinweis, allenfalls fetch und promise verwenden
	xhr[i] = new XMLHttpRequest();
	xhr[i].open('POST', i+'.txt', true);

	xhr[i].onload = function () {
		count++;
		if (count==nFiles) {
			//alert(count + " Files Loaded from Server");
			createArray();
			convertTimestampsToPixel();
			printArray();
			printGraph();
		}
		}; //hier darf man keine parameter übergeben wie (xhr[i], msg) sonst funktioniert das blöde XMLHttpRequest nicht richtig 

	xhr[i].send(null);
}


function convertTimestampsToPixel()
{
	var timespan = 0;
	timespan = stringArray[0][timestamp];
	
	for (i=0; i<stringArray.length; i++)
	{
		stringArray[i][timestamp]=(stringArray[i][timestamp]-timespan)/48;
	//	alert(stringArray[i][timestamp]);
	}


}


function printGraph()
{

	var udcMax=0;
	var pacMax=0;
	var pdcMax=0;	

	var c = document.getElementById("myCanvas");
	var context = c.getContext("2d");
	context.beginPath();
	context.moveTo(stringArray[0][timestamp],height-stringArray[0][pac]);
	
	for (i=1; i<stringArray.length; i++)
	{	
		context.lineWidth=3;
		context.lineTo(stringArray[i][timestamp],height-stringArray[i][pac]);
		
	}
	//	context.lineTo(stringArray[i][timestamp], height);
		context.lineTo(stringArray[stringArray.length-1][timestamp],height);
		context.lineTo(0, height);
	context.closePath();
	context.stroke();
	context.fillStyle = "rgba(255, 0, 0, 0.6)";
	context.fill();


	context.beginPath();
	context.moveTo(stringArray[0][timestamp],height-stringArray[0][pac]);
	for (i=1; i<stringArray.length; i++)
	{	
		context.lineWidth=3;
		context.lineTo(stringArray[i][timestamp],height-stringArray[i][pdc]);
		
	}
	//	context.lineTo(stringArray[i][timestamp], height);
		context.lineTo(stringArray[stringArray.length-1][timestamp],height);
		context.lineTo(0, height);
	context.closePath();
	context.stroke();
	context.fillStyle = "rgba(255, 255, 0, 0.6)";
	context.fill();

	for (i=1; i<stringArray.length; i++)
	{	
		context.lineWidth=3;
		context.lineTo(stringArray[i][timestamp],height-stringArray[i][udc]);
		
	}
	//	context.lineTo(stringArray[i][timestamp], height);
		context.lineTo(stringArray[stringArray.length-1][timestamp],height);
		context.lineTo(0, height);
	context.stroke();



}



//
//1519081200
//1519167600
       86400
//differenz


		</script>


	<canvas id="myCanvas" width="800" height="500" style="border:1px solid #d3d3d3;">
		Your browser does not support the HTML5 canvas tag.</canvas>




		<div id="output">TEST
		</div>


		</body>
</html>





